name: Build, Release app to Github Pages and Firebase Hosting

on:
  push:
    branches:
      - main

jobs:
  # This workflow contains a single job called "build"
  build:
    runs-on: ubuntu-latest

steps:
  - uses: actions/checkout@v1
  - uses: actions/setup-java@v1
    with:
      java-version: '12.x'
  - uses: subosito/flutter-action@v1
    with:
      channel: 'dev'

- name: 'Run flutter pub get'
  run: flutter pub get

- name: Enable flutter web
  run: flutter config --enable-web

- name: 'Build Web App'
  run: flutter build web -t lib/startup/main_prod.dart

- name: deploy
  uses: peaceiris/actions-gh-pages@v3
  with:
    github_token: ${{ secrets.TOKEN }}
    publish_dir: ./build/web
- name: Deploy to Firebase Hosting
  uses: w9jds/firebase-action@master
  with:
    args: deploy --only hosting
  env:
    FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}

