# Pre-release test workflow

name: Pre-Release Testing Workflow

on:
  pull_request:
    branches: [ pre ]

  workflow_dispatch:

jobs:

  app-test:
    name: App Testing (Pre-Release)
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./

    steps:
      - uses: actions/checkout@v2

      # Setup the flutter environment.
      - name: Setup the flutter environment
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable' # 'dev', 'alpha', default to: 'stable'
          # flutter-version: '1.12.x' # you can also specify exact version of flutter

      # Get flutter dependencies.
      - name: Get Flutter dependencies
        run: flutter pub get

      # Check for any formatting issues in the code.
      - name: Check for any formatting issues in the code
        run: flutter format -n --set-exit-if-changed .

      # Statically analyze the code for any errors.
      - name: Analyse the code for any errors
        run: flutter analyze .

      # Run widget tests for our flutter project.
      -name: Run widget tests
       run: flutter tests --coverage
      # - name: Run widget tests (forms) 
      #   run: flutter test test\forms --coverage
      # - name: Run widget tests (utils) 
      #   run: flutter test test\utils --coverage
      # - name: Run widget tests (widgets) 
      #   run: flutter test test\widgets --coverage
      # - name: Run widget tests (forms) 
      #   run: flutter test test\forms --coverage
      # - name: Run widget tests (home screen) 
      #   run: flutter test test\screen\home_screen_test.dart --coverage
      # - name: Run widget tests (module questions screen) 
      #   run: flutter test test\screen\module_questions_screen_test.dart --coverage
      # - name: Run widget tests (notifications screen) 
      #   run: flutter test test\screen\notifications_screen_test.dart --coverage
      # - name: Run widget tests (question and answers screen) 
      #   run: flutter test test\screen\question_and_answers_screen_test.dart --coverage
      # - name: Run widget tests (search results screen) 
      #   run: flutter test test\screen\search_results_screen_test.dart --coverage
      # - name: Run widget tests (user info) 
      #   run: flutter test test\screen\user_info_test.dart --coverage
      # - name: Run widget tests (post questions screen) 
      #   run: flutter test test\screens --platform chrome --coverage
      #   run: ls -R

      # Upload coverage to https://app.codecov.io/
      - name: Upload code coverage to codecov.io
        uses: codecov/codecov-action@v2 
        with: 
          token: ${{ secrets.CODECOV_TOKEN }} 
          file: ./coverage/lcov.info